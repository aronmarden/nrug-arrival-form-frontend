{"version":3,"file":"static/js/metrics-aggregate.5876f0e8.chunk.js","mappings":"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","sources":["../node_modules/@newrelic/browser-agent/dist/esm/common/harvest/harvest-scheduler.js","../node_modules/@newrelic/browser-agent/dist/esm/common/unload/eol.js","../node_modules/@newrelic/browser-agent/dist/esm/features/metrics/aggregate/framework-detection.js","../node_modules/@newrelic/browser-agent/dist/esm/features/metrics/aggregate/index.js","../node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"],"sourcesContent":["/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as submitData from '../util/submit-data';\nimport { SharedContext } from '../context/shared-context';\nimport { Harvest } from './harvest';\nimport { subscribeToEOL } from '../unload/eol';\nimport { SESSION_EVENTS } from '../session/session-entity';\n\n/**\n * Periodically invokes harvest calls and handles retries\n */\nexport class HarvestScheduler extends SharedContext {\n  /**\n     * Create a HarvestScheduler\n     * @param {string} endpoint - The base BAM endpoint name -- ex. 'events'\n     * @param {object} opts - The options used to configure the HarvestScheduler\n     * @param {Function} opts.onFinished - The callback to be fired when a harvest has finished\n     * @param {Function} opts.getPayload - A callback which can be triggered to return a payload for harvesting\n     * @param {number} opts.retryDelay - The number of seconds to wait before retrying after a network failure\n     * @param {boolean} opts.raw - Use a prefabricated payload shape as the harvest payload without the need for formatting\n     * @param {string} opts.customUrl - A custom url that falls outside of the shape of the standard BAM harvester url pattern.  Will use directly instead of concatenating various pieces\n     * @param {*} parent - The parent object, whose state can be passed into SharedContext\n     */\n  constructor(endpoint, opts, parent) {\n    super(parent); // gets any allowed properties from the parent and stores them in `sharedContext`\n    this.endpoint = endpoint;\n    this.opts = opts || {};\n    this.started = false;\n    this.timeoutHandle = null;\n    this.aborted = false; // this controls the per-interval and final harvests for the scheduler (currently per feature specific!)\n\n    this.harvest = new Harvest(this.sharedContext);\n\n    // unload if EOL mechanism fires\n    subscribeToEOL(this.unload.bind(this));\n\n    /* Flush all buffered data if session resets and give up retries. This should be synchronous to ensure that the correct `session` value is sent.\n      Since session-reset generates a new session ID and the ID is grabbed at send-time, any delays or retries would cause the payload to be sent under\n      the wrong session ID. */\n    this.sharedContext?.ee.on(SESSION_EVENTS.RESET, () => this.runHarvest({\n      forceNoRetry: true\n    }));\n  }\n\n  /**\n   * This function is only meant for the last outgoing harvest cycle of a page. It trickles down to using sendBeacon, which should not be used\n   * to send payloads while the page is still active, due to limitations on how much data can be buffered in the API at any one time.\n   */\n  unload() {\n    if (this.aborted) return;\n    // If opts.onUnload is defined, these are special actions to execute before attempting to send the final payload.\n    if (this.opts.onUnload) this.opts.onUnload();\n    this.runHarvest({\n      unload: true\n    });\n  }\n  startTimer(interval, initialDelay) {\n    this.interval = interval;\n    this.started = true;\n    this.scheduleHarvest(initialDelay != null ? initialDelay : this.interval);\n  }\n  stopTimer() {\n    let permanently = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    this.aborted = permanently; // stopping permanently is same as aborting, but this function also cleans up the setTimeout loop\n    this.started = false;\n    if (this.timeoutHandle) {\n      clearTimeout(this.timeoutHandle);\n    }\n  }\n  scheduleHarvest(delay, opts) {\n    if (this.timeoutHandle) return;\n    if (delay == null) {\n      delay = this.interval;\n    }\n    this.timeoutHandle = setTimeout(() => {\n      this.timeoutHandle = null;\n      this.runHarvest(opts);\n    }, delay * 1000);\n  }\n  runHarvest(opts) {\n    if (this.aborted) return;\n\n    /**\n     * This is executed immediately after harvest sends the data via XHR, or if there's nothing to send. Note that this excludes on unloading / sendBeacon.\n     * @param {Object} result\n     */\n    const cbRanAfterSend = result => {\n      if (opts?.forceNoRetry) result.retry = false; // discard unsent data rather than re-queuing for next harvest attempt\n      this.onHarvestFinished(opts, result);\n    };\n    let harvests = [];\n    let submitMethod;\n    let payload;\n    if (this.opts.getPayload) {\n      // Ajax & PVT & SR features provide a callback function to get data for harvesting\n      submitMethod = submitData.getSubmitMethod({\n        isFinalHarvest: opts?.unload\n      });\n      if (!submitMethod) return false;\n      const retry = !opts?.unload && submitMethod === submitData.xhr;\n      payload = this.opts.getPayload({\n        retry\n      });\n      if (!payload) {\n        if (this.started) {\n          this.scheduleHarvest();\n        }\n        return;\n      }\n      payload = Object.prototype.toString.call(payload) === '[object Array]' ? payload : [payload];\n      harvests.push(...payload);\n    }\n\n    /** sendX is used for features that do not supply a preformatted payload via \"getPayload\" */\n    let send = args => this.harvest.sendX(args);\n    if (harvests.length) {\n      /** _send is the underlying method for sending in the harvest, if sending raw we can bypass the other helpers completely which format the payloads */\n      if (this.opts.raw) send = args => this.harvest._send(args);\n      /** send is used to formated the payloads from \"getPayload\" and obfuscate before sending */else send = args => this.harvest.send(args);\n    } else {\n      // force it to run at least once in sendX mode\n      harvests.push(undefined);\n    }\n    harvests.forEach(payload => {\n      send({\n        endpoint: this.endpoint,\n        payload,\n        opts,\n        submitMethod,\n        cbFinished: cbRanAfterSend,\n        customUrl: this.opts.customUrl,\n        raw: this.opts.raw\n      });\n    });\n    if (this.started) {\n      this.scheduleHarvest();\n    }\n  }\n  onHarvestFinished(opts, result) {\n    if (this.opts.onFinished) {\n      this.opts.onFinished(result);\n    }\n    if (result.sent && result.retry) {\n      const delay = result.delay || this.opts.retryDelay;\n      // reschedule next harvest if should be delayed longer\n      if (this.started && delay) {\n        clearTimeout(this.timeoutHandle);\n        this.timeoutHandle = null;\n        this.scheduleHarvest(delay, opts);\n      } else if (!this.started && delay) {\n        // if not running on a timer, schedule a single retry\n        this.scheduleHarvest(delay, opts);\n      }\n    }\n  }\n}","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { windowAddEventListener } from '../event-listener/event-listener-opts';\nimport { globalScope, isWorkerScope, isBrowserScope } from '../constants/runtime';\nimport { subscribeToVisibilityChange } from '../window/page-visibility';\nif (isWorkerScope) {\n  globalScope.cleanupTasks = []; // create new list on WorkerGlobalScope to track funcs to run before exiting thread\n\n  const origClose = globalScope.close;\n  globalScope.close = () => {\n    // on worker's EoL signal, execute all \"listeners\", e.g. final harvests\n    for (let task of globalScope.cleanupTasks) {\n      task();\n    }\n    origClose();\n  };\n}\n\n/**\n * Subscribes a provided callback to the time/event when the agent should treat it as end-of-life.\n * This is used, for example, to submit a final harvest and send all remaining data on best-effort.\n * @param {function} cb - func to run before or during the last reliable event or time of an env's life span\n */\nexport function subscribeToEOL(cb) {\n  if (isBrowserScope) {\n    subscribeToVisibilityChange(cb, true); // when user switches tab or hides window, esp. mobile scenario\n    windowAddEventListener('pagehide', cb); // when user navigates away, and because safari iOS v14.4- doesn't fully support vis change\n    // --this ought to be removed once support for version below 14.5 phases out\n  } else if (isWorkerScope) {\n    globalScope.cleanupTasks.push(cb); // close() should run these tasks before quitting thread\n  }\n  // By default (for other env), this fn has no effect.\n}","import { isBrowserScope } from '../../../common/constants/runtime';\nconst FRAMEWORKS = {\n  REACT: 'React',\n  NEXTJS: 'NextJS',\n  VUE: 'Vue',\n  NUXTJS: 'NuxtJS',\n  ANGULAR: 'Angular',\n  ANGULARUNIVERSAL: 'AngularUniversal',\n  SVELTE: 'Svelte',\n  SVELTEKIT: 'SvelteKit',\n  PREACT: 'Preact',\n  PREACTSSR: 'PreactSSR',\n  ANGULARJS: 'AngularJS',\n  BACKBONE: 'Backbone',\n  EMBER: 'Ember',\n  METEOR: 'Meteor',\n  ZEPTO: 'Zepto',\n  JQUERY: 'Jquery',\n  MOOTOOLS: 'MooTools',\n  QWIK: 'Qwik',\n  ELECTRON: 'Electron'\n};\nexport function getFrameworks() {\n  if (!isBrowserScope) return []; // don't bother detecting frameworks if not in the main window context\n\n  const frameworks = [];\n  try {\n    if (detectReact()) {\n      frameworks.push(FRAMEWORKS.REACT);\n      if (detectNextJS()) frameworks.push(FRAMEWORKS.NEXTJS);\n    }\n    if (detectVue()) {\n      frameworks.push(FRAMEWORKS.VUE);\n      if (detectNuxtJS()) frameworks.push(FRAMEWORKS.NUXTJS);\n    }\n    if (detectAngular()) {\n      frameworks.push(FRAMEWORKS.ANGULAR);\n      if (detectAngularUniversal()) frameworks.push(FRAMEWORKS.ANGULARUNIVERSAL);\n    }\n    if (detectSvelte()) {\n      frameworks.push(FRAMEWORKS.SVELTE);\n      if (detectSvelteKit()) frameworks.push(FRAMEWORKS.SVELTEKIT);\n    }\n    if (detectPreact()) {\n      frameworks.push(FRAMEWORKS.PREACT);\n      if (detectPreactSSR()) frameworks.push(FRAMEWORKS.PREACTSSR);\n    }\n    if (detectAngularJs()) frameworks.push(FRAMEWORKS.ANGULARJS);\n    if (Object.prototype.hasOwnProperty.call(window, 'Backbone')) frameworks.push(FRAMEWORKS.BACKBONE);\n    if (Object.prototype.hasOwnProperty.call(window, 'Ember')) frameworks.push(FRAMEWORKS.EMBER);\n    if (Object.prototype.hasOwnProperty.call(window, 'Meteor')) frameworks.push(FRAMEWORKS.METEOR);\n    if (Object.prototype.hasOwnProperty.call(window, 'Zepto')) frameworks.push(FRAMEWORKS.ZEPTO);\n    if (Object.prototype.hasOwnProperty.call(window, 'jQuery')) frameworks.push(FRAMEWORKS.JQUERY);\n    if (Object.prototype.hasOwnProperty.call(window, 'MooTools')) frameworks.push(FRAMEWORKS.MOOTOOLS);\n    if (Object.prototype.hasOwnProperty.call(window, 'qwikevents')) frameworks.push(FRAMEWORKS.QWIK);\n    if (detectElectron()) frameworks.push(FRAMEWORKS.ELECTRON);\n  } catch (err) {\n    // Possibly not supported\n  }\n  return frameworks;\n}\nfunction detectReact() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'React') || Object.prototype.hasOwnProperty.call(window, 'ReactDOM') || Object.prototype.hasOwnProperty.call(window, 'ReactRedux') || document.querySelector('[data-reactroot], [data-reactid]') || (() => {\n      const divs = document.querySelectorAll('body > div');\n      for (let i = 0; i < divs.length; i++) {\n        if (Object.prototype.hasOwnProperty.call(divs[i], '_reactRootContainer')) {\n          return true;\n        }\n      }\n    })();\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectNextJS() {\n  // React SSR\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'next') && Object.prototype.hasOwnProperty.call(window.next, 'version');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectVue() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'Vue');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectNuxtJS() {\n  // Vue SSR\n  try {\n    return Object.prototype.hasOwnProperty.call(window, '$nuxt') && Object.prototype.hasOwnProperty.call(window.$nuxt, 'nuxt');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectAngular() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'ng') || document.querySelector('[ng-version]');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectAngularUniversal() {\n  // Anguler SSR\n  try {\n    return document.querySelector('[ng-server-context]');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectSvelte() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, '__svelte');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectSvelteKit() {\n  // Svelte SSR\n  try {\n    return !!Object.keys(window).find(prop => prop.startsWith('__sveltekit'));\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectPreact() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'preact');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectPreactSSR() {\n  // Svelte SSR\n  try {\n    return document.querySelector('script[type=\"__PREACT_CLI_DATA__\"]');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectAngularJs() {\n  try {\n    return Object.prototype.hasOwnProperty.call(window, 'angular') || document.querySelector('.ng-binding, [ng-app], [data-ng-app], [ng-controller], [data-ng-controller], [ng-repeat], [data-ng-repeat]') || document.querySelector('script[src*=\"angular.js\"], script[src*=\"angular.min.js\"]');\n  } catch (err) {\n    return false;\n  }\n}\nfunction detectElectron() {\n  try {\n    return typeof navigator === 'object' && typeof navigator.userAgent === 'string' && navigator.userAgent.indexOf('Electron') >= 0;\n  } catch (err) {\n    return false;\n  }\n}","import { getRuntime, getConfiguration } from '../../../common/config/config';\nimport { registerHandler } from '../../../common/event-emitter/register-handler';\nimport { HarvestScheduler } from '../../../common/harvest/harvest-scheduler';\nimport { FEATURE_NAME, SUPPORTABILITY_METRIC, CUSTOM_METRIC, SUPPORTABILITY_METRIC_CHANNEL, CUSTOM_METRIC_CHANNEL } from '../constants';\nimport { getFrameworks } from './framework-detection';\nimport { isFileProtocol } from '../../../common/url/protocol';\nimport { getRules, validateRules } from '../../../common/util/obfuscate';\nimport { onDOMContentLoaded } from '../../../common/window/load';\nimport { windowAddEventListener } from '../../../common/event-listener/event-listener-opts';\nimport { isBrowserScope, isWorkerScope } from '../../../common/constants/runtime';\nimport { AggregateBase } from '../../utils/aggregate-base';\nexport class Aggregate extends AggregateBase {\n  static featureName = FEATURE_NAME;\n  constructor(agentIdentifier, aggregator) {\n    super(agentIdentifier, aggregator, FEATURE_NAME);\n    let scheduler;\n\n    // If RUM-call's response determines that customer lacks entitlements for the /jserror ingest endpoint, don't harvest at all.\n    registerHandler('block-err', () => {\n      this.blocked = true;\n      if (scheduler) scheduler.aborted = true; // RUM response may or may not have happened already before scheduler initialization below\n    }, this.featureName, this.ee);\n\n    // Allow features external to the metrics feature to capture SMs and CMs through the event emitter\n    registerHandler(SUPPORTABILITY_METRIC_CHANNEL, this.storeSupportabilityMetrics.bind(this), this.featureName, this.ee);\n    registerHandler(CUSTOM_METRIC_CHANNEL, this.storeEventMetrics.bind(this), this.featureName, this.ee);\n    this.singleChecks(); // checks that are run only one time, at script load\n    this.eachSessionChecks(); // the start of every time user engages with page\n\n    this.ee.on(\"drain-\".concat(this.featureName), () => {\n      // *cli, Mar 23 - Per NR-94597, this feature should only harvest ONCE at the (potential) EoL time of the page.\n      scheduler = new HarvestScheduler('jserrors', {\n        onUnload: () => this.unload()\n      }, this);\n      scheduler.harvest.on('jserrors', () => ({\n        body: this.aggregator.take(['cm', 'sm'])\n      }));\n    }); // this is needed to ensure EoL is \"on\" and sent\n\n    this.drain();\n  }\n  storeSupportabilityMetrics(name, value) {\n    if (this.blocked) return;\n    const type = SUPPORTABILITY_METRIC;\n    const params = {\n      name\n    };\n    this.aggregator.storeMetric(type, name, params, value);\n  }\n  storeEventMetrics(name, metrics) {\n    if (this.blocked) return;\n    const type = CUSTOM_METRIC;\n    const params = {\n      name\n    };\n    this.aggregator.store(type, name, params, metrics);\n  }\n  singleChecks() {\n    // report loaderType\n    const {\n      distMethod,\n      loaderType\n    } = getRuntime(this.agentIdentifier);\n    if (loaderType) this.storeSupportabilityMetrics(\"Generic/LoaderType/\".concat(loaderType, \"/Detected\"));\n    if (distMethod) this.storeSupportabilityMetrics(\"Generic/DistMethod/\".concat(distMethod, \"/Detected\"));\n\n    // frameworks on page\n    if (isBrowserScope) {\n      this.storeSupportabilityMetrics('Generic/Runtime/Browser/Detected');\n\n      // These SMs are used by the AppExp team\n      onDOMContentLoaded(() => {\n        getFrameworks().forEach(framework => {\n          this.storeSupportabilityMetrics('Framework/' + framework + '/Detected');\n        });\n      });\n    } else if (isWorkerScope) {\n      this.storeSupportabilityMetrics('Generic/Runtime/Worker/Detected');\n    } else {\n      this.storeSupportabilityMetrics('Generic/Runtime/Unknown/Detected');\n    }\n\n    // Track if the agent is being loaded using a file protocol such as is the case in some\n    // set-top box applications or Electron applications\n    if (isFileProtocol()) {\n      this.storeSupportabilityMetrics('Generic/FileProtocol/Detected');\n    }\n\n    // Capture SMs to assess customer engagement with the obfuscation config\n    const rules = getRules(this.agentIdentifier);\n    if (rules.length > 0) this.storeSupportabilityMetrics('Generic/Obfuscate/Detected');\n    if (rules.length > 0 && !validateRules(rules)) this.storeSupportabilityMetrics('Generic/Obfuscate/Invalid');\n\n    // Check if proxy for either chunks or beacon is being used\n    const {\n      proxy\n    } = getConfiguration(this.agentIdentifier);\n    if (proxy.assets) this.storeSupportabilityMetrics('Config/AssetsUrl/Changed');\n    if (proxy.beacon) this.storeSupportabilityMetrics('Config/BeaconUrl/Changed');\n  }\n  eachSessionChecks() {\n    if (!isBrowserScope) return;\n\n    // [Temporary] Report restores from BFCache to NR1 while feature flag is in place in lieu of sending pageshow events.\n    windowAddEventListener('pageshow', evt => {\n      if (evt.persisted) {\n        this.storeSupportabilityMetrics('Generic/BFCache/PageRestored');\n      }\n    });\n  }\n  unload() {\n    try {\n      if (this.resourcesSent) return;\n      this.resourcesSent = true; // make sure this only gets sent once\n\n      const agentRuntime = getRuntime(this.agentIdentifier);\n\n      // Capture SMs around network resources using the performance API to assess\n      // work to split this out from the ST nodes\n      // differentiate between internal+external and ajax+non-ajax\n      const ajaxResources = ['beacon', 'fetch', 'xmlhttprequest'];\n      const internalUrls = ['nr-data.net', 'newrelic.com', 'nr-local.net', 'localhost'];\n      function isInternal(x) {\n        return internalUrls.some(y => x.name.indexOf(y) >= 0);\n      }\n      function isAjax(x) {\n        return ajaxResources.includes(x.initiatorType);\n      }\n      const allResources = performance?.getEntriesByType('resource') || [];\n      allResources.forEach(entry => {\n        if (isInternal(entry)) {\n          if (isAjax(entry)) this.storeSupportabilityMetrics('Generic/Resources/Ajax/Internal');else this.storeSupportabilityMetrics('Generic/Resources/Non-Ajax/Internal');\n        } else {\n          if (isAjax(entry)) this.storeSupportabilityMetrics('Generic/Resources/Ajax/External');else this.storeSupportabilityMetrics('Generic/Resources/Non-Ajax/External');\n        }\n      });\n\n      // Capture SMs for session trace if active (`ptid` is set when returned by replay ingest).\n      // Retain these SMs while we are working through the session_replay feature\n      if (agentRuntime.ptid) {\n        this.storeSupportabilityMetrics('PageSession/Feature/SessionTrace/DurationMs', Math.round(performance.now()));\n      }\n\n      // Capture SMs for performance markers and measures to assess the usage and possible inclusion of this\n      // data in the agent for use in NR\n      if (typeof performance !== 'undefined') {\n        const markers = performance.getEntriesByType('mark');\n        const measures = performance.getEntriesByType('measure');\n        this.storeSupportabilityMetrics('Generic/Performance/Mark/Seen', markers.length);\n        this.storeSupportabilityMetrics('Generic/Performance/Measure/Seen', measures.length);\n      }\n    } catch (e) {\n      // do nothing\n    }\n  }\n}","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}"],"names":["HarvestScheduler","_SharedContext","_inherits","_super","_createSuper","endpoint","opts","parent","_this$sharedContext","_this","_classCallCheck","call","started","timeoutHandle","aborted","harvest","Harvest","sharedContext","subscribeToEOL","unload","bind","_assertThisInitialized","ee","on","SESSION_EVENTS","RESET","runHarvest","forceNoRetry","_createClass","key","value","this","onUnload","interval","initialDelay","scheduleHarvest","permanently","arguments","length","undefined","clearTimeout","delay","_this2","setTimeout","_this3","submitMethod","payload","cbRanAfterSend","result","retry","onHarvestFinished","harvests","getPayload","submitData","isFinalHarvest","Object","prototype","toString","push","apply","_toConsumableArray","send","args","sendX","raw","_send","forEach","cbFinished","customUrl","onFinished","sent","retryDelay","SharedContext","isWorkerScope","globalScope","cleanupTasks","origClose","close","_step","_iterator","_createForOfIteratorHelper","s","n","done","task","err","e","f","cb","isBrowserScope","subscribeToVisibilityChange","windowAddEventListener","FRAMEWORKS","getFrameworks","frameworks","hasOwnProperty","window","document","querySelector","divs","querySelectorAll","i","detectReact","next","detectNextJS","detectVue","$nuxt","detectNuxtJS","detectAngular","detectAngularUniversal","detectSvelte","keys","find","prop","startsWith","detectSvelteKit","detectPreact","detectPreactSSR","detectAngularJs","navigator","userAgent","indexOf","detectElectron","Aggregate","_AggregateBase","agentIdentifier","aggregator","scheduler","FEATURE_NAME","registerHandler","blocked","featureName","SUPPORTABILITY_METRIC_CHANNEL","storeSupportabilityMetrics","CUSTOM_METRIC_CHANNEL","storeEventMetrics","singleChecks","eachSessionChecks","concat","body","take","drain","name","type","SUPPORTABILITY_METRIC","params","storeMetric","metrics","CUSTOM_METRIC","store","_getRuntime","getRuntime","distMethod","loaderType","onDOMContentLoaded","framework","isFileProtocol","rules","getRules","validateRules","proxy","getConfiguration","assets","beacon","evt","persisted","_this4","_performance","isAjax","x","ajaxResources","includes","initiatorType","resourcesSent","agentRuntime","internalUrls","performance","getEntriesByType","entry","some","y","ptid","Math","round","now","markers","measures","AggregateBase","_defineProperty","o","allowArrayLike","it","Symbol","iterator","Array","isArray","F","_e","TypeError","normalCompletion","didErr","step","_e2"],"sourceRoot":""}